<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="decimal.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous">


<style>

    input[type="color"].custom {
        padding: 0;
        border: none;
        height: 1150px;
        width: 50px;
        vertical-align: middle;
    }

    .theth {
        /*background-color: #e0e0e0 !important;*/
        text-align: center;
    }

    .theOrderMaterialsBy.orderSelected {
        background-color: #e0e0e0 !important;
    }

    .theResult th {
        background-color: #e0e0e0 !important;
        white-space: nowrap !important;
    }

    .slider {
        position: relative;
        z-index: 1;
        height: 18px;
        margin: 0 40px 0 40px;

    }

    .slider > .track {
        position: absolute;
        z-index: 1;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        border-radius: 5px;
        /*background-image: linear-gradient(to right, lightblue, lightcoral);*/
        /*background-color: #c6aee7;*/
        /*background-color: #f0f0f0;*/
    }

    .slider > .range {
        position: absolute;
        z-index: 2;
        left: 5%;
        right: 5%;
        top: 0;
        bottom: 0;
        border-radius: 5px;
        /*background-color: #6200ee;*/
        background-color: lightgreen;
        /*background-image: linear-gradient(to right, lightblue , lightcoral);*/
        /*opacity: 40%;*/
    }


</style>
<script>

    $(document).ready(function () {
        $("#theCopy").click(function () {
            saveLink();
        });
    });

    function icolor(rgb) {
        rgb = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
        var red = parseInt(rgb[1]);
        var green = parseInt(rgb[2]);
        var blue = parseInt(rgb[3]);
        return [red,green,blue];
    }

    function toHex(colorArray) {
        return '#' + colorArray[0].toString(16) + colorArray[1].toString(16) + colorArray[2].toString(16);
    }


    function saveLink() {
        let data = [];
        $('[id^=wearme]').each(function () {
            data.push([
                parseInt($(this).data('weared-item-id')),
                parseInt($(this).find('.theMaterial option:selected').val()),
                parseInt($(this).find('.theQuality option:selected').val()),
                icolor($(this).find('.theName').css('background-color')),
            ]);
        });

        let theData = btoa(JSON.stringify(data));

        let toCopy = window.location.origin + '' + window.location.pathname + '#' + theData;


        try {
            navigator.clipboard.writeText(toCopy).then(function () {
                alert('Copied ok.');
            }, function () {
                console.log(toCopy);
                alert('Failure to copy.\nProbably page not loaded via https.\nYou can use console log to get the URLs');
            });
        } catch (e) {
            console.log(toCopy);
            //https://developer.mozilla.org/en-US/docs/Web/API/Clipboard/writeText
            alert('Failure to copy.\nProbably page not loaded via https.\nYou can use console log to get the URLs.');
        }

    }

    function toogleBigResult() {
        $('#theItemListTD').toggle();
        $('#theHeaderInfoTD').toggle();

        if ($('#theItemListTD').is(':visible')) {
            $('.enlargeLink').text('Enlarge');
        }else{
            $('.enlargeLink').text('Shrink');
        }

    }



</script>



<table class="table table-bordered table-sm">
    <thead>
    <tr>
        <th class="theth text-small" style="width: 220px;">Headgear</th>
        <th class="theth" style="width: 220px;">Middle</th>
        <th class="theth" style="width: 220px;">Outer</th>
        <th class="theth" style="max-width: 1450px" id="theHeaderInfoTD">
            <table style="width: 100%;background-color: #e0e0e0;">
                <tr>
                    <td style="width: 70%;text-align: center;font-size: 14px;font-weight: bold;">Worn items</td>
                    <td style="text-align: right;text-wrap: none;"><button class="btn btn-sm btn-primary btn-sm" id="theCopy" style="padding: 1px !important;font-size: 12px !important;">copy link</button></td>
                </tr>
            </table>
        </th>
        <th class="theth">Result</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td valign="middle" align="center" style="padding: 2px !important;">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="201px" height="135px" viewBox="-0.5 -0.5 201 195">
                <defs/>
                <g>
                    <!-- headgear -->
                    <ellipse cx="100" cy="85" rx="70" ry="85" fill="#fff3f2" stroke="#ae4132" pointer-events="all"/>
                    <path id="layer_1_3" data-part-name="right_ear" data-occupied-by="" d="M 170 40 Q 200 40 200 80 Q 200 120 170 120 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          stroke-miterlimit="10" pointer-events="all"/>
                    <path id="layer_1_2" data-part-name="left_ear" data-occupied-by="" d="M 0 40 Q 30 40 30 80 Q 30 120 0 120 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          stroke-miterlimit="10" transform="rotate(-180,15,80)" pointer-events="all"/>
                    <ellipse id="layer_1_12" data-part-name="left_eye" data-occupied-by="" cx="70" cy="70" rx="20" ry="20" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                             pointer-events="all"/>
                    <ellipse id="layer_1_13" data-part-name="right_eye" data-occupied-by="" cx="130" cy="70" rx="20" ry="20" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                             pointer-events="all"/>
                    <path id="layer_1_14" data-partn-name="nose" data-occupied-by="" d="M 85 80 L 115 95 L 85 110 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"
                          transform="rotate(-90,100,95)" pointer-events="all"/>
                    <path id="layer_1_15" data-partn-name="jaw" data-occupied-by="" d="M 80 90 Q 120 90 120 150 Q 120 210 80 210 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          stroke-miterlimit="10" transform="rotate(90,100,150)" pointer-events="all"/>
                    <path id="layer_1_1" data-partn-name="head" data-occupied-by="" d="M 80 -40 Q 120 -40 120 20 Q 120 80 80 80 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          stroke-miterlimit="10" transform="rotate(-90,100,20)" pointer-events="all"/>
                    <rect id="layer_1_5" data-partn-name="neck" data-occupied-by="" x="75" y="170" width="50" height="20" rx="4.5" ry="4.5" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          pointer-events="all"/>

                </g>
            </svg>
        </td>
        <td rowspan="3" valign="middle" align="center" style="padding-top: 44px !important;">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="155px" height="332px" viewBox="-0.5 -0.5 201 432">
                <defs/>
                <g>
                    <ellipse cx="100" cy="85" rx="70" ry="85" fill="#fff3f2" stroke="#c0c0c0" pointer-events="all"/>
                    <path id="layer_4_3" data-part-name="right_ear" data-occupied-by="" d="M 170 40 Q 200 40 200 80 Q 200 120 170 120 Z" fill="rgb(255, 255, 255)" stroke="#c0c0c0"
                          stroke-miterlimit="10" pointer-events="all"/>
                    <path id="layer_4_2" data-part-name="left_ear" data-occupied-by="" d="M 0 40 Q 30 40 30 80 Q 30 120 0 120 Z" fill="rgb(255, 255, 255)" stroke="#c0c0c0"
                          stroke-miterlimit="10" transform="rotate(-180,15,80)" pointer-events="all"/>
                    <ellipse id="layer_4_12" data-part-name="left_eye" data-occupied-by="" cx="70" cy="70" rx="20" ry="20" fill="rgb(255, 255, 255)" stroke="#c0c0c0"
                             pointer-events="all"/>
                    <ellipse id="layer_4_13" data-part-name="right_eye" data-occupied-by="" cx="130" cy="70" rx="20" ry="20" fill="rgb(255, 255, 255)" stroke="#c0c0c0"
                             pointer-events="all"/>
                    <path id="layer_4_14" data-partn-name="nose" data-occupied-by="" d="M 85 80 L 115 95 L 85 110 Z" fill="rgb(255, 255, 255)" stroke="#c0c0c0" stroke-miterlimit="10"
                          transform="rotate(-90,100,95)" pointer-events="all"/>
                    <path id="layer_4_15" data-partn-name="jaw" data-occupied-by="" d="M 80 90 Q 120 90 120 150 Q 120 210 80 210 Z" fill="rgb(255, 255, 255)" stroke="#c0c0c0"
                          stroke-miterlimit="10" transform="rotate(90,100,150)" pointer-events="all"/>
                    <path id="layer_4_1" data-partn-name="head" data-occupied-by="" d="M 80 -40 Q 120 -40 120 20 Q 120 80 80 80 Z" fill="rgb(255, 255, 255)" stroke="#c0c0c0"
                          stroke-miterlimit="10" transform="rotate(-90,100,20)" pointer-events="all"/>
                    <rect id="layer_4_5" data-partn-name="neck" data-occupied-by="" x="75" y="170" width="50" height="30" rx="4.5" ry="4.5" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          pointer-events="all"/>
                    <rect id="layer_4_4" data-partn-name="torso" data-occupied-by="" x="40" y="210" width="120" height="110" rx="16.5" ry="16.5" fill="rgb(255, 255, 255)"
                          stroke="rgb(0, 0, 0)" pointer-events="all"/>
                    <rect id="layer_4_6" data-partn-name="left_shoulder" data-occupied-by="" x="20" y="200" width="80" height="40" rx="6" ry="6" fill="rgb(255, 255, 255)"
                          stroke="rgb(0, 0, 0)" pointer-events="all"/>
                    <rect id="layer_4_8" data-partn-name="right_shoulder" data-occupied-by="" x="100" y="200" width="80" height="40" rx="6" ry="6" fill="rgb(255, 255, 255)"
                          stroke="rgb(0, 0, 0)" pointer-events="all"/>
                    <rect id="layer_4_7" data-partn-name="left_arm" data-occupied-by="" x="-45" y="260" width="120" height="20" rx="3" ry="3" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          transform="rotate(-90,15,270)" pointer-events="all"/>
                    <rect id="layer_4_9" data-partn-name="right_arm" data-occupied-by="" x="125" y="260" width="120" height="20" rx="3" ry="3" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          transform="rotate(-90,185,270)" pointer-events="all"/>
                    <rect id="layer_4_10" data-partn-name="left_leg" data-occupied-by="" x="-5" y="360" width="120" height="20" rx="3" ry="3" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          transform="rotate(-75,55,370)" pointer-events="all"/>
                    <rect id="layer_4_11" data-partn-name="right_leg" data-occupied-by="" x="85" y="360" width="120" height="20" rx="3" ry="3" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          transform="rotate(-105,145,370)" pointer-events="all"/>
                </g>
            </svg>
        </td>
        <td rowspan="3" valign="middle" align="center" style="padding-top: 44px !important;">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="155px" height="332px" viewBox="-0.5 -0.5 201 432">
                <defs/>
                <g>
                    <ellipse cx="100" cy="85" rx="70" ry="85" fill="#fff3f2" stroke="#c0c0c0" pointer-events="all"/>
                    <path id="layer_3_3" data-part-name="right_ear" data-occupied-by="" d="M 170 40 Q 200 40 200 80 Q 200 120 170 120 Z" fill="rgb(255, 255, 255)" stroke="#c0c0c0"
                          stroke-miterlimit="10" pointer-events="all"/>
                    <path id="layer_3_2" data-part-name="left_ear" data-occupied-by="" d="M 0 40 Q 30 40 30 80 Q 30 120 0 120 Z" fill="rgb(255, 255, 255)" stroke="#c0c0c0"
                          stroke-miterlimit="10" transform="rotate(-180,15,80)" pointer-events="all"/>
                    <ellipse id="layer_3_12" data-part-name="left_eye" data-occupied-by="" cx="70" cy="70" rx="20" ry="20" fill="rgb(255, 255, 255)" stroke="#c0c0c0"
                             pointer-events="all"/>
                    <ellipse id="layer_3_13" data-part-name="right_eye" data-occupied-by="" cx="130" cy="70" rx="20" ry="20" fill="rgb(255, 255, 255)" stroke="#c0c0c0"
                             pointer-events="all"/>
                    <path id="layer_3_14" data-partn-name="nose" data-occupied-by="" d="M 85 80 L 115 95 L 85 110 Z" fill="rgb(255, 255, 255)" stroke="#c0c0c0" stroke-miterlimit="10"
                          transform="rotate(-90,100,95)" pointer-events="all"/>
                    <path id="layer_3_15" data-partn-name="jaw" data-occupied-by="" d="M 80 90 Q 120 90 120 150 Q 120 210 80 210 Z" fill="rgb(255, 255, 255)" stroke="#c0c0c0"
                          stroke-miterlimit="10" transform="rotate(90,100,150)" pointer-events="all"/>
                    <path id="layer_3_1" data-partn-name="head" data-occupied-by="" d="M 80 -40 Q 120 -40 120 20 Q 120 80 80 80 Z" fill="rgb(255, 255, 255)" stroke="#c0c0c0"
                          stroke-miterlimit="10" transform="rotate(-90,100,20)" pointer-events="all"/>
                    <rect id="layer_3_5" data-partn-name="neck" data-occupied-by="" x="75" y="170" width="50" height="30" rx="4.5" ry="4.5" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          pointer-events="all"/>
                    <rect id="layer_3_4" data-partn-name="torso" data-occupied-by="" x="40" y="210" width="120" height="110" rx="16.5" ry="16.5" fill="rgb(255, 255, 255)"
                          stroke="rgb(0, 0, 0)" pointer-events="all"/>
                    <rect id="layer_3_6" data-partn-name="left_shoulder" data-occupied-by="" x="20" y="200" width="80" height="40" rx="6" ry="6" fill="rgb(255, 255, 255)"
                          stroke="rgb(0, 0, 0)" pointer-events="all"/>
                    <rect id="layer_3_8" data-partn-name="right_shoulder" data-occupied-by="" x="100" y="200" width="80" height="40" rx="6" ry="6" fill="rgb(255, 255, 255)"
                          stroke="rgb(0, 0, 0)" pointer-events="all"/>
                    <rect id="layer_3_7" data-partn-name="left_arm" data-occupied-by="" x="-45" y="260" width="120" height="20" rx="3" ry="3" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          transform="rotate(-90,15,270)" pointer-events="all"/>
                    <rect id="layer_3_9" data-partn-name="right_arm" data-occupied-by="" x="125" y="260" width="120" height="20" rx="3" ry="3" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          transform="rotate(-90,185,270)" pointer-events="all"/>
                    <rect id="layer_3_10" data-partn-name="left_leg" data-occupied-by="" x="-5" y="360" width="120" height="20" rx="3" ry="3" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          transform="rotate(-75,55,370)" pointer-events="all"/>
                    <rect id="layer_3_11" data-partn-name="right_leg" data-occupied-by="" x="85" y="360" width="120" height="20" rx="3" ry="3" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          transform="rotate(-105,145,370)" pointer-events="all"/>
                </g>
            </svg>
        </td>
        <td rowspan="3" width="100%" id="theItemListTD">
            <table class="table table-sm table-bordered" style="font-size: 12px !important;">
                <thead>
                <th style="width: 0px;"></th>
                <th>Item Name</th>
                <th>Mass</th>
                <!--
                                <th>HP</th>
                                <th>Cold</th>
                                <th>Heat</th>
                                <th>Sharp</th>
                                <th>Blunt</th>
                                <th>Heat</th>
                -->
                <th>Material</th>
                <th>Quality</th>
                <th id="armor_sharp_factor" class="theOrderMaterialsBy orderSelected">Sharp</th>
                <th id="armor_blunt_factor" class="theOrderMaterialsBy" data-selected="true">Blunt</th>
                <th id="armor_heat_factor" class="theOrderMaterialsBy" data-selected="true">Heat</th>
                <th id="max_hit_points_factor" class="theOrderMaterialsBy" data-selected="true">HP</th>
                <th id="insulation_cold" class="theOrderMaterialsBy" data-selected="true">iCold</th>
                <th id="insulation_heat" class="theOrderMaterialsBy" data-selected="true">iHeat</th>
                <th>Cost</th>
                </thead>
                <tbody id="wearContents">

                </tbody>
                <tfoot>
                <tr>
                    <td colspan="17">
                        <table class="table table-sm" style="border-width: 0;">
                            <tr>
                                <th align="right" class="theth" style="font-size: 12px;background-color: lightblue !important;">-270&deg;
                                </th>
                                <td style="width: 100%;padding: 0;margin: 0;background-image: linear-gradient(to right, lightblue, lightcoral);" valign="middle">
                                    <div class="slider">
                                        <div class="track"></div>
                                        <div id="theRange" class="range" style="left: 11%; right: 41%;">
                                            <span id="minConfy" style="float: left;font-size:12px;color: black;position:absolute;left: -36px;">-99.9&deg;</span>
                                            <span id="maxConfy" style="float: right;font-size:12px;color: black;position:absolute;right: -36px;">+99.9&deg;</span>
                                            <div style="clear: both;"></div>
                                        </div>
                                    </div>
                                </td>
                                <th class="theth" style="font-size: 12px;background-color: lightcoral !important;">+270&deg;</th>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td colspan="17" id="totalCost">

                    </td>
                </tr>
                </tfoot>
            </table>
            <br>

        </td>
        <td rowspan="3" id="theResTD" style="min-width: 470px">


            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true">Numbers</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false">HP</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="visual2-tab" data-bs-toggle="tab" data-bs-target="#visual2-tab-pane" type="button" role="tab" aria-controls="visual2-tab-pane" aria-selected="false">Protection</button>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
                    <table class="table table-sm table-bordered theResult" style="font-size: 12px !important;border-color: #f0f0f0;">
                        <thead>
                        <th>&nbsp;</th>
                        <th>HP</th>
                        <th>Sharp</th>
                        <th>Blunt</th>
                        <th>Heat</th>
                        </thead>
                        <tbody id="resultBodyParts">
                        </tbody>
                    </table>

                </div>
                <div class="tab-pane fade show active" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
                    <table style="font-size: 12px !important;border-bottom-width:0 !important;border-color: red; border-width: 0 !important;padding: 0 !important;border-collapse: collapse !important;border-spacing: 0 !important;width: 100%;">
                        <thead>
                        <th style="height: 20px;font-size: 12px;color: black;font-weight: bold;padding-bottom: 5px;width: 100px;max-width: 100px;border-right: 10px;">

                        </th>
                        <th style="height: 20px;font-size: 14px;color: black;font-weight: bold;padding-bottom: 5px;width: 100%;text-align: center;border-bottom: 1px solid black;">
                            Hit Points
                        </th>
                        </thead>
                        <tbody id="resultVisualBodyParts">
<!--
                        <tr>
                            <td align="right" style="padding-right: 10px;">UpperHead</td>
                            <td style="background: linear-gradient(to right, #c0c0c0 0% 50%, blue 50% 60%, green 60% 100%);width: 370px;">
                                <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" style="width: 100px;height: 10px;" border="0">
                            </td>
                        </tr>
                        <tr>
                            <td>UpperHead</td>
                            <td style="background: linear-gradient(to right, #c0c0c0 0% 30%, blue 30% 70%, green 70% 100%);width: 370px;">
                                <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" style="width: 100px;height: 10px;" border="0">
                            </td>
                        </tr>
-->

                        </tbody>
                        <tfoot>
                        <tr>
                            <th colspan="4" style="text-align: center;padding-top: 10px;">
                                <a href="https://rimworldwiki.com/wiki/Table_of_Human_Body_Part_Groups" target="_blank">Body groups</a>
                                <br><br>
                                <a href="#" onclick="toogleBigResult();" class="enlargeLink">Enlarge</a>
                            </th>
                        </tr>

                        </tfoot>

                    </table>
                </div>



                <div class="tab-pane fade" id="visual2-tab-pane" role="tabpanel" aria-labelledby="visual2-tab" tabindex="0">

                    <table style="font-size: 12px !important;border-bottom-width:0 !important;border-color: red; border-width: 0 !important;padding: 0 !important;border-collapse: collapse !important;border-spacing: 0 !important;width: 100%;">
                        <thead>
                        <th style="height: 20px;font-size: 12px;color: black;font-weight: bold;padding-bottom: 5px;width: 100px;max-width: 100px;border-right: 10px;">

                        </th>
                        <th style="height: 20px;font-size: 14px;color: black;font-weight: bold;padding-bottom: 5px;width: 34%;text-align: center;border-bottom: 1px solid black;">
                            Sharp
                        </th>
                        <th style="height: 20px;font-size: 14px;color: black;font-weight: bold;padding-bottom: 5px;width: 33%;text-align: center;border-bottom: 1px solid black;">
                            Blunt
                        </th>
                        <th style="height: 20px;font-size: 14px;color: black;font-weight: bold;padding-bottom: 5px;width: 33%;text-align: center;border-bottom: 1px solid black;">
                            Heat
                        </th>
                        </thead>
                        <tbody id="resultVisual2BodyParts">
                        <!--
                            <tr>
                                <td align="right" style="padding-right: 10px;">UpperHead</td>
                                <td style="background: linear-gradient(to right, #c0c0c0 0% 50%, blue 50% 60%, green 60% 100%);width: 370px;">
                                    <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" style="width: 100px;height: 10px;" border="0">
                                </td>
                                <td style="background: linear-gradient(to right, #c0c0c0 0% 50%, blue 50% 60%, green 60% 100%);width: 370px;border-left: 10px solid white;">
                                    <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" style="width: 100px;height: 10px;" border="0">
                                </td>
                                <td style="background: linear-gradient(to right, #c0c0c0 0% 50%, blue 50% 60%, green 60% 100%);width: 370px;border-left: 10px solid white;">
                                    <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" style="width: 100px;height: 10px;" border="0">
                                </td>
                            </tr>
                            <tr>
                                <td>UpperHead</td>
                                <td style="background: linear-gradient(to right, #c0c0c0 0% 30%, blue 30% 70%, green 70% 100%);width: 370px;">
                                    <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" style="width: 100px;height: 10px;" border="0">
                                </td>
                                <td style="background: linear-gradient(to right, #c0c0c0 0% 30%, blue 30% 70%, green 70% 100%);width: 370px;border-left: 10px solid white;">
                                    <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" style="width: 100px;height: 10px;" border="0">
                                </td>
                                <td style="background: linear-gradient(to right, #c0c0c0 0% 30%, blue 30% 70%, green 70% 100%);width: 370px;border-left: 10px solid white;">
                                    <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" style="width: 100px;height: 10px;" border="0">
                                </td>
                            </tr>
                            -->

                        </tbody>
                        <tfoot>
                        <tr>
                            <th colspan="4" style="text-align: center;padding-top: 10px;">
                                <a href="https://rimworldwiki.com/wiki/Table_of_Human_Body_Part_Groups" target="_blank">Body groups</a>
                                <br><br>
                                <a href="#" onclick="toogleBigResult();" class="enlargeLink">Enlarge</a>
                            </th>
                        </tr>

                        </tfoot>
                    </table>




                </div>
            </div>



        </td>
    </tr>
    <tr>
        <th class="theth">Skin</th>
    </tr>
    <tr>
        <td valign="middle" align="center" style="padding: 2px !important;">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="191px" height="201px" viewBox="-0.5 -0.5 191 262"
                 content=""
                 style="background-color: rgb(255, 255, 255);">
                <defs/>
                <g>
                    <rect id="layer_2_5" data-partn-name="neck" data-occupied-by="" x="70" y="0" width="50" height="30" rx="4.5" ry="4.5" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          pointer-events="all"/>
                    <rect id="layer_2_4" data-partn-name="torso" data-occupied-by="" x="35" y="40" width="120" height="110" rx="16.5" ry="16.5" fill="rgb(255, 255, 255)"
                          stroke="rgb(0, 0, 0)" pointer-events="all"/>
                    <rect id="layer_2_6" data-partn-name="left_shoulder" data-occupied-by="" x="15" y="30" width="80" height="40" rx="6" ry="6" fill="rgb(255, 255, 255)"
                          stroke="rgb(0, 0, 0)" pointer-events="all"/>
                    <rect id="layer_2_8" data-partn-name="right_shoulder" data-occupied-by="" x="95" y="30" width="80" height="40" rx="6" ry="6" fill="rgb(255, 255, 255)"
                          stroke="rgb(0, 0, 0)" pointer-events="all"/>
                    <rect id="layer_2_7" data-partn-name="left_arm" data-occupied-by="" x="-50" y="90" width="120" height="20" rx="3" ry="3" stroke-width="1" fill="rgb(255, 255, 255)"
                          stroke="rgb(0, 0, 0)" transform="rotate(-90,10,100)" pointer-events="all"/>
                    <rect id="layer_2_9" data-partn-name="right_arm" data-occupied-by="" x="120" y="90" width="120" height="20" rx="3" ry="3" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          transform="rotate(-90,180,100)" pointer-events="all"/>
                    <rect id="layer_2_10" data-partn-name="left_leg" data-occupied-by="" x="-10" y="190" width="120" height="20" rx="3" ry="3" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          transform="rotate(-75,50,200)" pointer-events="all"/>
                    <rect id="layer_2_11" data-partn-name="right_leg" data-occupied-by="" x="80" y="190" width="120" height="20" rx="3" ry="3" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"
                          transform="rotate(-105,140,200)" pointer-events="all"/>
                </g>
            </svg>
        </td>
    </tr>

    </tbody>
</table>


<div class="container-fluid text-center w-100 m-0">
    <div class="row">
        <div class="col" id="coreItemList">
            <img src="images/72px-RimWorldLogo.png" width="40" height="40">
            <hr>
        </div>
        <div class="col" id="biotechItemList">
            <img src="images/40px-BiotechIcon.png" width="40" height="40">
            <hr>
        </div>
        <div class="col" id="ideologyItemList">
            <img src="images/40px-IdeologyIcon.png" width="40" height="40">
            <hr>
        </div>
        <div class="col" id="royalityItemList">
            <img src="images/40px-RoyaltyIcon.png" width="40" height="40">
            <hr>
        </div>
    </div>
</div>

<span style="display: none" id="toCloneItem" data-item-id="" data-coverage-ids="" data-layer="" data-item-data="">
    <span class="btn btn-light btn-sm text-nowrap"><img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" width="24" height="24" alt="ITEM NAME"/><span class="text-nowrap">ITEM NAME</span></span>
</span>

<table style="display: none">
    <tr id="cloneTr">
        <td valign="middle" align="center">
            <a class="btn btn-sm undressMe" href="#" role="button" style="background-color: #FF5555;font-size: 10px;color:white;font-weight: bold;">X</a>
        </td>
        <td class="theName" style="background-color: aqua;white-space: nowrap;" valign="middle">
            <table cellpadding="0" cellspacing="0" border="0" style="width: 100%"><tr>
                <td><img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" width="24" height="24" alt="ITEM NAME"/></td>
                <td><span class="text-nowrap" style="white-space: nowrap !important;font-size: 12px;">ITEM NAME</span></td>
                <td align="right"><input type="color" class="form-control form-control-color" value="#FF0000" style="width:12px;height:12px;padding:0;border-width: 2px;border-color:black;"></td>
            </tr></table>
        </td>
        <td valign="middle" align="right" class="theMass forBodyGroupHover" data-mass="" style="white-space: nowrap;"></td>
        <!--
            <td valign="middle" align="right" class="theHitpoints" data-hitpoints=""></td>
            <td valign="middle" align="center" class="theCold" data-cold=""></td>
            <td valign="middle" align="right" class="theHeat" data-heat=""></td>
            <td valign="middle" align="right" class="theFactor_sharp" data-factor_sharp=""></td>
            <td valign="middle" align="right" class="theFactor_blunt" data-factor_blunt=""></td>
            <td valign="middle" align="right" class="theFactor_heat" data-factor_heat=""></td>
        -->
        <td class="forBodyGroupHover">
            <select class="form-control form-control-sm theMaterial" style="font-size: 12px !important;width: 120px;">
            </select>
        </td>
        <td class="forBodyGroupHover">
            <select class="form-control form-control-sm theQuality" style="font-size: 12px !important;width: 90px;">
                <option value="1" class="itq1" data-quality-variation="">Awful</option>
                <option value="2" class="itq2" data-quality-variation="">Poor</option>
                <option value="3" class="itq3" data-quality-variation="">Normal</option>
                <option value="4" class="itq4" data-quality-variation="">Good</option>
                <option value="5" class="itq5" data-quality-variation="">Excellent</option>
                <option value="6" class="itq6" data-quality-variation="">Masterwork</option>
                <option value="7" class="itq7" data-quality-variation="">Legendary</option>
            </select>

        </td>
        <td class="materialArmorSharp forBodyGroupHover"></td>
        <td class="materialArmorBlunt forBodyGroupHover"></td>
        <td class="materialArmorHeat forBodyGroupHover"></td>
        <td class="materialHP forBodyGroupHover"></td>
        <td class="materialCold forBodyGroupHover"></td>
        <td class="materialHeat forBodyGroupHover"></td>
        <td valign="middle" class="theCost forBodyGroupHover"></td>
    </tr>
    <tr id="cloneBodyGroup">
        <th class="theName" style="width: 1px;">Torso</th>
        <td class="theHitPoints" align="right"></td>
        <td class="theArmorSharp" align="right"></td>
        <td class="theArmorBlunt" align="right"></td>
        <td class="theArmorHeat" align=right></td>

    </tr>
    <!--background: linear-gradient(to right, red 0% 33%, yellow 33% 66%, green 66% 100%);-->
    <tr id="cloneVisualBodyGroup">
        <td class="theName" align="right" style="padding-right: 10px;">Name</td>
        <td class="theProtection" style="width: 370px;" align="right">
            <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" style="width: 100px;height: 10px;" border="0">
        </td>
    </tr>

    <tr id="cloneVisual2">
        <td align="right" style="padding-right: 10px;" class="theName">Name</td>
        <td class="theSharp" style="width: 370px;" align="right">
            <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" style="width: 100px;height: 10px;" border="0">
        </td>
        <td class="theBlunt" style="width: 370px;border-left: 10px solid white;" align="right">
            <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" style="width: 100px;height: 10px;" border="0">
        </td>
        <td class="theHeat" style="width: 370px;border-left: 10px solid white;" align="right">
            <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" style="width: 100px;height: 10px;" border="0">
        </td>
    </tr>

</table>


<script type="module">
    let minimumAcceptableTemperature = 16;
    let maximumAcceptableTemperature = 26;

    let costs = {
        "1": "STUFF",
        "2": "COMPONENT",
        "3": "PLASTEEL",
        "4": "STEEL",
        "5": "CLOTH",
        "6": "URANIUM",
        "7": "ADVANCED COMPONENT",
        "8": "CHEMFUEL",
        "9": "POWERFOCUS CHIP",
        "10": "SIGNAL CHIP",
        "11": "NANO STRUCTURING CHIP",
        "12": "GOLD"
    };

    let isMaterialCostId = "1";

    //dont judge
    let costsCommonWithMaterial = {
        "32":"3", //plasteel
        "34":"4", //steel
        "8":"5", //cloth
        "35":"6",//uranium
        "31":"12", //gold
    };



    let bodyGroups = {
        "1": "Torso",
        "2": "UpperHead",
        "3": "FullHead",
        "4": "Shoulders",
        "5": "Arms",
        "6": "Hands",
        "7": "LeftHand",
        "8": "RightHand",
        "9": "Legs",
        "10": "Feet"
    };

    let bodyGroupOrder = [2,3,1,4,5,6,7,8,9,10];


    let bodyGroupContains = {
        "2": [1, 2, 3], //head, skull, brain, ears
        "3": [1, 2, 3, 12, 13, 14, 15], //head, skull, brain, eyes, ears, nose, jaw
        "1": [4, 5], //clavicles, sternum, ribs, pelvis, spine, stomach, heart, lungs, kidneys, liver, neck
        "4": [6, 8], //shoulders
        "5": [7, 9], //arms, hands, humeri, radii
        "6": [7, 9], //hands, fingers.
        "7": [7], //left hand, left hand fingers
        "8": [9], //right hand, right hand fingers
        "9": [10, 11], //legs, feet, femurs, tibiae
        "10": [10, 11] //feet, toes
    };

    let bodyPartsInGroup = {
        "1": [2, 3], //head
        "2": [2, 3], // left ear
        "3": [2, 3], // right ear
        "4": [1], //torso
        "5": [1], //neck
        "6": [4], //left shoulder
        "7": [5, 6, 7], // left arm
        "8": [4], // right shoulder
        "9": [5, 6, 8], // right arm
        "10": [9, 10], //left leg
        "11": [9, 10], // right leg
        "12": [3], // left eye
        "13": [3],  // right eye
        "14": [3],   //nose
        "15": [3]  //jaw
    }

    let cover = {
        "1": "HEAD",
        "2": "LEFT EAR",
        "3": "RIGHT EAR",
        "4": "TORSO",
        "5": "NECK",
        "6": "LEFT SHOULDER",
        "7": "LEFT ARM",
        "8": "RIGHT SHOULDER",
        "9": "RIGHT ARM",
        "10": "LEFT LEG",
        "11": "RIGHT LEG",
        "12": "LEFT EYE",
        "13": "RIGHT EYE",
        "14": "NOSE",
        "15": "JAW",
        "16": "UPPER HEAD"
    };

    let materials = {
        "30": "-",
        "1": "Alpaca wool",
        "2": "Bearskin",
        "3": "Birdskin",
        "4": "Bison wool",
        "5": "Bluefur",
        "6": "Camelhide",
        "7": "Chinchilla fur",
        "8": "Cloth",
        "9": "Devilstrand",
        "10": "Dog leather",
        "11": "Elephant leather",
        "12": "Foxfur",
        "13": "Guinea pig fur",
        "14": "Heavy fur",
        "15": "Human leather",
        "16": "Hyperweave",
        "17": "Lightleather",
        "18": "Lizardskin",
        "19": "Megasloth wool",
        "20": "Muffalo wool",
        "21": "Panthera fur",
        "22": "Patchleather",
        "23": "Pigskin",
        "24": "Plainleather",
        "25": "Rhinoceros leather",
        "26": "Sheep wool",
        "27": "Synthread",
        "28": "Thrumbofur",
        "29": "Wolfskin",
        "31": "Gold",
        "32": "Plasteel",
        "33": "Silver",
        "34": "Steel",
        "35": "Uranium",
        "36": "Wood",
    };

    let isNoMaterialId = 30;

    let quality = {
        "1": "Awful",
        "2": "Poor",
        "3": "Normal",
        "4": "Good",
        "5": "Excellent",
        "6": "Masterwork",
        "7": "Legendary",
    };

    let qualityProtectionFactor = {
        /* "Awful" */ "1": 0.6,
        /* "Poor" */ "2": 0.8,
        /* "Normal" */ "3": 1,
        /* "Good" */ "4": 1.15,
        /* "Excellent" */ "5": 1.3,
        /* "Masterwork" */ "6": 1.45,
        /* "Legendary" */ "7": 1.8
    };

    let qualityInsulationFactor = {
        /* "Awful" */ "1": 0.8,
        /* "Poor" */ "2": 0.9,
        /* "Normal" */ "3": 1,
        /* "Good" */ "4": 1.1,
        /* "Excellent" */ "5": 1.2,
        /* "Masterwork" */ "6": 1.5,
        /* "Legendary" */ "7": 1.8
    }

    let colors = ["#e1a99a","#848693","#94a2a3","#aac2b5","#d78c79","#5c5f72","#718385","#8cac9d"];

    let colorIndex = 0;

    //because id order "didn't matter" making the data :(
    let mistakeLayer = {
        //"5":"EYES",
        "1":"HEADGEAR",
        "4":"MIDDLE",
        "3":"OUTER",
        "2":"SKIN",
    };

    let orderLayer = ["2","1","4","3"];


    // when opening the page with file:// using below import will not work
    import itemsCore from "./data/items_core.json" assert {type: "json"};
    import itemsBiotech from "./data/items_biotech.json" assert {type: "json"};
    import itemsIdeology from "./data/items_ideology.json" assert {type: "json"};
    import itemsRoyality from "./data/items_royality.json" assert {type: "json"};
    import materialData from "./data/material.json" assert {type: "json"};
    import itemCost from "./data/item_cost.json" assert {type: "json"};


    function undressItem(itemId) {
        colorIndex--;

        let iid = $('#theitem' + itemId);
        let covered = iid.data('coverage-ids').split(',');
        let layers = iid.data('layer').split(',');
        layers.forEach(function (la) {
            covered.forEach(function (co) {
                $('#layer_' + la + '_' + co)
                    .css('fill', 'rgb(255,255,255)')
                    .css('stroke-width', '1')
                    .data('occupied-by', '');
            });
        });

        grayItemsThatCannotBeWearedAnyMore(itemId);

        $('#wearme' + itemId).remove();

        calcConfyTemp();
        showTotalCost();
        calculateResult();
    }

    function calcConfyTemp() {
        let confyCold = new Decimal(minimumAcceptableTemperature);
        let confyHeat = new Decimal(maximumAcceptableTemperature);

        $('[id^=wearme]').each(function () {
            confyCold = confyCold.minus($(this).find('.materialCold').text());
            confyHeat = confyHeat.plus($(this).find('.materialHeat').text());
        });

        showConfy(mathStuff(confyCold.toFixed(3), 1, 1, 10, 1, 10), mathStuff(confyHeat.toFixed(3), 1, 1, 10, 1, 10));
    }

    String.prototype.ucfirst = function() {
        return this.charAt(0).toUpperCase() + this.substr(1);
    };

    function showTotalCost() {

        let totalMaterials = {};
        let totalCosts = {};

        $('[id^=wearme]').each(function () {
            let wearedItemId = $(this).data('weared-item-id')
            for (let costId in itemCost[wearedItemId]) {
                if (costId === isMaterialCostId) {
                    $('#wearme' + wearedItemId + ' .theMaterial option:selected').val()
                    let materialId = $(this).find('.theMaterial option:selected').val();

                    if (materialId in costsCommonWithMaterial) {
                        let delegatedCostId = costsCommonWithMaterial[materialId];
                        if (!(delegatedCostId in totalCosts)) {
                            totalCosts[delegatedCostId] = new Decimal(0);
                        }
                        totalCosts[delegatedCostId] = totalCosts[delegatedCostId].plus(itemCost[wearedItemId][costId]);
                    }else {
                        if (!(materialId in totalMaterials)) {
                            totalMaterials[materialId] = new Decimal(0);
                        }
                        totalMaterials[materialId] = totalMaterials[materialId].plus(itemCost[wearedItemId][costId]);
                    }

                } else {
                    if (!(costId in totalCosts)) {
                        totalCosts[costId] = new Decimal(0);
                    }
                    totalCosts[costId] = totalCosts[costId].plus(itemCost[wearedItemId][costId]);
                }
            }
        });

        let totalCost = $('#totalCost');
        totalCost.text('');
        for (let materialId in totalMaterials) {
            totalCost.append($('<img>', {
                src: 'images/material_' + materialId + '.png',
                width: 18,
                height: 18,
                title: materials[materialId]
            }));
            totalCost.append(materials[materialId]+'&nbsp;');
            totalCost.append('x'+totalMaterials[materialId].toFixed(0)+'<br>');
        }
        for (let costId in totalCosts) {
            totalCost.append($('<img>', {
                src: 'images/cost_' + costId + '.png',
                width: 18,
                height: 18,
                title: costs[costId]
            }));
            totalCost.append(costs[costId].toLowerCase().ucfirst()+'&nbsp;');
            totalCost.append('x'+totalCosts[costId].toFixed(0)+'<br>');
        }

    }

    function grayItemsThatCannotBeWearedAnyMore(removingItemId) {
        let layersStillCovered = {};

        $('[id^=wearme]').each(function () {
            if ($(this).data('weared-item-id') !== removingItemId) {
                let stillWorn = JSON.parse(atob($('#theitem' + $(this).data('weared-item-id')).data('item-data')));
                stillWorn.layer.split(',').forEach(function (la) {
                    let dakey = 'L' + la;
                    if (dakey in layersStillCovered) {
                        layersStillCovered[dakey] = layersStillCovered[dakey].concat(stillWorn.coverage.split(','));
                    } else {
                        layersStillCovered[dakey] = stillWorn.coverage.split(',');
                    }
                });
            }
        });

        $('[id^=theitem]').each(function () {
            //show it
            let showit = true;

            let shownItemLayer = $(this).data('layer').split(',');
            let shownItemCoverage = $(this).data('coverage-ids').split(',');

            shownItemLayer.forEach(function (la) {
                let fla = 'L' + la;
                if (fla in layersStillCovered) {
                    shownItemCoverage.forEach(function (co) {
                        if (layersStillCovered[fla].includes(co)) {
                            showit = false;
                        }
                    });
                }
            });

            if (showit) {
                $(this).find('span').find('span').css('color', '#000000');
                $(this).find('span').find('img').css('opacity', '1');
            } else {
                //not sure if this is still needed as it should already be hidden
                $(this).find('span').find('span').css('color', '#d0d0d0');
                $(this).find('span').find('img').css('opacity', '0.3');
            }

        });
    }

    function changeColorOfWearItem(itemData, toColor) {
        $('#wearme'+itemData.item_id+' .theName').css('background-color', toColor);

        calculateResult();

        let covered = itemData.coverage.split(',');
        let layers = itemData.layer.split(',');
        layers.forEach(function (la) {
            covered.forEach(function (co) {
                $('#layer_' + la + '_' + co).css('fill', toColor);
            });
        });

    }

    function wear(itemData, forceMaterialId = null, forceQualityId = null, forcedColor = null) {
        let theTr = $('#cloneTr').clone();
        theTr.prop('id', 'wearme' + itemData.item_id);
        theTr.data('weared-item-id', itemData.item_id);

        let thisColor = colors[colorIndex];
        let thisColorHex = colors[colorIndex];
        if (forcedColor !== null) {
            thisColor = 'rgb(' + forcedColor[0] + ',' + forcedColor[1] + ',' + forcedColor[2] + ')';
            thisColorHex = toHex(forcedColor);
        }
        theTr.find('.theName').css('background-color', thisColor);
        theTr.find('.theName').find('.text-nowrap').html('<A href="https://rimworldwiki.com/wiki/' + itemData.item_name + '" target="_blank" style="color:black;">' + itemData.item_name + '</A>&nbsp;');

        theTr.find('.theName').find('.form-control-color').val(thisColorHex).change(function () {
            changeColorOfWearItem(itemData, $(this).val());
        });
        theTr.find('.theName').find('img').prop('src', 'images/' + itemData.img_name + '.png');

        theTr.find('.undressMe').click(function () {
            undressItem($(this).parent().parent().data('weared-item-id'));
        })

        let covered = itemData.coverage.split(',');
        let layers = itemData.layer.split(',');
        let isAlreadyOccupied = false;
        layers.forEach(function (la) {
            covered.forEach(function (co) {
                let laco = $('#layer_' + la + '_' + co);
                if (laco.data('occupied-by') !== '') {
                    isAlreadyOccupied = true;
                    return false;
                }
                laco.css('fill', thisColor).data('occupied-by', itemData.item_id);
            });
            if (isAlreadyOccupied) {
                return false;
            }
        });

        if (isAlreadyOccupied) {
            if (!confirm('Already occupied, proceed ?')) {
                return false;
            }
            alert('No.');
            return false;
        }

        theTr.find('.theName').mouseover(function () {
            layers.forEach(function (la) {
                covered.forEach(function (co) {
                    $('#layer_' + la + '_' + co).css('stroke-width', '8');
                });
            });
        })

        theTr.find('.theName').mouseout(function () {
            layers.forEach(function (la) {
                covered.forEach(function (co) {
                    $('#layer_' + la + '_' + co).css('stroke-width', '1');
                });
            });
        })

        theTr.find('.theMass').text((parseFloat(itemData.mass) / 100) + ' kg');

        // Factors removed from the list because the occupied a lot of space.
        /*
        theTr.find('.theHitpoints').text(parseInt(itemData.hitpoints));
        if (itemData.cold !== null ) {
            theTr.find('.theCold').text(parseFloat(itemData.cold) + 'x');
        }
        if (itemData.heat !== null ) {
            theTr.find('.theHeat').text(parseFloat(itemData.heat) + 'x');
        }
        if (itemData.factor_sharp !== null ) {
            theTr.find('.theFactor_sharp').text(parseFloat(itemData.factor_sharp) + 'x');
        }
        if (itemData.factor_blunt !== null ) {
            theTr.find('.theFactor_blunt').text(parseFloat(itemData.factor_blunt) + 'x');
        }
        if (itemData.factor_blunt !== null ) {
            theTr.find('.theFactor_blunt').text(parseFloat(itemData.factor_blunt) + 'x');
        }
        if (itemData.factor_heat !== null ) {
            theTr.find('.theFactor_heat').text(parseFloat(itemData.factor_heat) + 'x');
        }
        */

        let sortedMaterials = orderTheseMaterialsBy(itemData.materials, $('.theOrderMaterialsBy.orderSelected').prop('id'));
        for (let idx in sortedMaterials) {
            theTr.find('.theMaterial').append(new Option(materials[sortedMaterials[idx]], sortedMaterials[idx]));
        }

        if (forceMaterialId !== null) {
            theTr.find('.theMaterial').val(forceMaterialId);
        }

        theTr.find('.theMaterial').change(function () {
            onChangeMaterial(itemData.item_id, $(this).val());
        })

        let useQuality = 3;
        let lastUsedQuality = $('[id^=wearme] .theQuality:last option:selected').val();
        if (lastUsedQuality !== undefined) {
            useQuality = lastUsedQuality;
        }
        if (forceQualityId !== null) {
            useQuality = forceQualityId;
        }

        theTr.find('.theQuality').val(useQuality);
        theTr.find('.theQuality').change(function () {
            onChangeQuality(itemData.item_id, $(this).val())
        })

        colorIndex++;

        $('#wearContents').append(theTr);

        for (let costId in itemCost[itemData.item_id]) {
            if (costId === isMaterialCostId) {
                theTr.find('.theCost').append($('<img>', {
                    class: 'theMaterialPic',
                    src: 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=',
                    width: 16,
                    height: 16,
                    title: 'Material'
                }));
                theTr.find('.theCost').append('x'+itemCost[itemData.item_id][costId]);

            } else {
                theTr.find('.theCost').append($('<img>', {
                    src: 'images/cost_' + costId + '.png',
                    width: 16,
                    height: 16,
                    title:costs[costId]
                }));
                theTr.find('.theCost').append('x'+itemCost[itemData.item_id][costId]);
            }
        }

        showItemVariation(
            itemData.item_id,
            $('#wearme' + itemData.item_id + ' .theMaterial option:selected').val(),
            $('#wearme' + itemData.item_id + ' .theQuality option:selected').val()
        );

        calcConfyTemp();
        showTotalCost();

        grayItemsThatCannotBeWearedAnyMore(-1);

    }

    function onChangeMaterial(itemId, materialId) {
        showItemVariation(itemId, materialId, $('#wearme' + itemId + ' .theQuality option:selected').val());
        calcConfyTemp();
        showTotalCost();
    }

    function onChangeQuality(itemId, qualityId) {
        showItemVariation(itemId, $('#wearme' + itemId + ' .theMaterial option:selected').val(), qualityId);
        calcConfyTemp();
    }

    function calculateItemVariation(itemId, materialId, qualityId, doRound = true) {

        let itemData = JSON.parse(atob($('#theitem' + itemId).data('item-data')));

        return {
            'cold': mathStuff(itemData.cold, materialData[materialId].insulation_cold, qualityInsulationFactor[qualityId], 1000, 3, 1000),
            'heat': mathStuff(itemData.heat, materialData[materialId].insulation_heat, qualityInsulationFactor[qualityId], 1000, 3, 1000),
            'armorSharp': mathStuff(itemData.factor_sharp, materialData[materialId].armor_sharp_factor, qualityProtectionFactor[qualityId], 10000, 6, 100),
            'armorBlunt': mathStuff(itemData.factor_blunt, materialData[materialId].armor_blunt_factor, qualityProtectionFactor[qualityId], 10000, 6, 100),
            'armorHeat': mathStuff(itemData.factor_heat, materialData[materialId].armor_heat_factor, qualityProtectionFactor[qualityId], 10000, 6, 100),
            'hitPoints': mathStuff(itemData.hitpoints, materialData[materialId].max_hit_points_factor, 1, 100, 3, 100),
        };

    }

    function mathStuff(itemFactor, materialFactor, qualityFactor, theTimes, theToFixed, theDiv) {

        if (materialFactor === null) {
            materialFactor = 1;
        }

        return Math.round(
            (new Decimal(itemFactor))
                .times(materialFactor)
                .times(qualityFactor)
                .times(theTimes)
                .toFixed(theToFixed)
        ) / theDiv;
    }

    function showItemVariation(itemId, materialId, qualityId) {

        let calculated = calculateItemVariation(itemId, materialId, qualityId);

        $('#wearme' + itemId + ' .theMaterialPic').prop('src', 'images/material_'+materialId+'.png').prop('title',materials[materialId]);

        $('#wearme' + itemId + ' .materialArmorSharp').text(calculated.armorSharp);
        $('#wearme' + itemId + ' .materialArmorBlunt').text(calculated.armorBlunt);
        $('#wearme' + itemId + ' .materialArmorHeat').text(calculated.armorHeat);
        $('#wearme' + itemId + ' .materialHP').text(calculated.hitPoints);
        $('#wearme' + itemId + ' .materialCold').text(calculated.cold);
        $('#wearme' + itemId + ' .materialHeat').text(calculated.heat);

        calculateResult();

    }


    function addItem(itemData, appendTo) {
        let item = $('#toCloneItem').clone();
        item.prop('id', 'theitem' + itemData.item_id);
        item.css('display', 'inline');
        item.find('img').prop('src', './images/' + itemData.img_name + '.png');
        item.find('span').find('span').text(itemData.item_name);
        item.data('item-id', itemData.item_id)
        item.data('item-data', btoa(JSON.stringify(itemData)))
        item.data('coverage-ids', itemData.coverage)
        item.data('layer', itemData.layer)

        item.mouseover(function () {
            let covered = $(this).data('coverage-ids').split(',');
            let layers = $(this).data('layer').split(',');
            layers.forEach(function (la) {
                covered.forEach(function (co) {
                    let laco = $('#layer_' + la + '_' + co);
                    laco.css('stroke-width', '8');
                    if (laco.data('occupied-by') !== '') {
                        laco.css('stroke', '#FF5555');
                    }
                });
            });

            let wierdItems = {42: true} //Blindfold

            if (itemData.item_id in wierdItems) {
                $(this).find('span').find('span').css('cursor', 'not-allowed');
            }

        });
        item.mouseout(function () {
            let covered = $(this).data('coverage-ids').split(',');
            let layers = $(this).data('layer').split(',');
            layers.forEach(function (la) {
                covered.forEach(function (co) {
                    $('#layer_' + la + '_' + co).css('stroke-width', '1').css('stroke', '#000000');
                });
            });
        });

        item.click(function () {
            wear(JSON.parse(atob($(this).data('item-data'))));
        })


        $('#' + appendTo).append(item);
    }

    function calculateResult() {

        let bodyGroupResult = {};
        for (let i in bodyGroups) {
            bodyGroupResult[i] = {"HP": new Decimal(0), "ArmorSharp": new Decimal(0), "ArmorBlunt": new Decimal(0), "ArmorHeat": new Decimal(0)};
        }

        let byBodyGroupWornItems = [];

        //make an array with items by body group
        $('[id^=wearme]').each(function () {
            let wearingItem = JSON.parse(atob($('#theitem' + $(this).data('weared-item-id')).data('item-data')));
            wearingItem.coverage = wearingItem.coverage.split(',');
            let wearingItemBodyGroupsKeys = [];
            for (let k in wearingItem.coverage) {
                for (let k2 in bodyPartsInGroup[wearingItem.coverage[k]]) {
                    wearingItemBodyGroupsKeys[bodyPartsInGroup[wearingItem.coverage[k]][k2]] = {
                        "HP": $(this).find('.materialHP').text(),
                        "ArmorSharp": $(this).find('.materialArmorSharp').text(),
                        "ArmorBlunt": $(this).find('.materialArmorBlunt').text(),
                        "ArmorHeat": $(this).find('.materialArmorHeat').text(),
                        "ItemId": $(this).data('weared-item-id'),
                        "Layers": wearingItem.layer.split(','),
                    };
                }
            }
            byBodyGroupWornItems.push(wearingItemBodyGroupsKeys);
        });

        //aggregate data by bodygroup
        let bodyGroupProtection = {};
        let bodyGroupSBHProtection = {};
        for (let idx in byBodyGroupWornItems) {
            for (let xBodyGroupId in byBodyGroupWornItems[idx]) {

                if (!(xBodyGroupId in bodyGroupProtection)) {
                    bodyGroupProtection[xBodyGroupId] = {};
                    bodyGroupSBHProtection[xBodyGroupId] = {};
                }

                let theFreakingLayerOrder = 0;
                byBodyGroupWornItems[idx][xBodyGroupId]['Layers'].forEach(function (mistakeLayId) {
                    theFreakingLayerOrder += 10** orderLayer.indexOf(mistakeLayId);
                });

                 if (!(theFreakingLayerOrder in bodyGroupProtection[xBodyGroupId])) {
                     bodyGroupProtection[xBodyGroupId][theFreakingLayerOrder] = {};
                     bodyGroupSBHProtection[xBodyGroupId][theFreakingLayerOrder] = {};
                 }

                 //because you can wear face mask and a cowboy hat
                 bodyGroupProtection[xBodyGroupId][theFreakingLayerOrder][byBodyGroupWornItems[idx][xBodyGroupId]['ItemId']] = byBodyGroupWornItems[idx][xBodyGroupId]['HP'];

                let deciPercentSharp = (new Decimal(byBodyGroupWornItems[idx][xBodyGroupId]['ArmorSharp'])).div(100).toFixed(3);
                let deciPercentBlunt = (new Decimal(byBodyGroupWornItems[idx][xBodyGroupId]['ArmorBlunt'])).div(100).toFixed(3);
                let deciPercentHeat = (new Decimal(byBodyGroupWornItems[idx][xBodyGroupId]['ArmorHeat'])).div(100).toFixed(3);

                 let thisSharp = (new Decimal(byBodyGroupWornItems[idx][xBodyGroupId]['HP'])).mul(deciPercentSharp).toFixed(2);
                 let thisBlunt = (new Decimal(byBodyGroupWornItems[idx][xBodyGroupId]['HP'])).mul(deciPercentBlunt).toFixed(2);
                 let thisHeat = (new Decimal(byBodyGroupWornItems[idx][xBodyGroupId]['HP'])).mul(deciPercentHeat).toFixed(2);

                 //these s,b,h keys need to be the same as in the variable sbh a few lines below
                 bodyGroupSBHProtection[xBodyGroupId][theFreakingLayerOrder][byBodyGroupWornItems[idx][xBodyGroupId]['ItemId']] = {
                    "s": thisSharp, "b": thisBlunt, "h": thisHeat
                 };

                bodyGroupResult[xBodyGroupId]['HP'] = (bodyGroupResult[xBodyGroupId]['HP']).plus(byBodyGroupWornItems[idx][xBodyGroupId]['HP']);
                bodyGroupResult[xBodyGroupId]['ArmorSharp'] = (bodyGroupResult[xBodyGroupId]['ArmorSharp']).plus(thisSharp);
                bodyGroupResult[xBodyGroupId]['ArmorBlunt'] = (bodyGroupResult[xBodyGroupId]['ArmorBlunt']).plus(thisBlunt);
                bodyGroupResult[xBodyGroupId]['ArmorHeat'] = (bodyGroupResult[xBodyGroupId]['ArmorHeat']).plus(thisHeat);
            }
        }

        //calculate the maxHitPoints of a body group (to be used in percentages of visuals
        let maxHitPoints = 0;
        let maxArmorSharpBluntHeat = 0;

        for (let yBodyGroupId in bodyGroupResult) {
            let thisHp = Math.round(bodyGroupResult[yBodyGroupId]['HP'].toFixed(3) * 100) / 100;
            if (thisHp > maxHitPoints) {
                maxHitPoints = thisHp;
            }
            let thisSharp = Math.round(bodyGroupResult[yBodyGroupId]['ArmorSharp'].toFixed(3) * 100) / 100;
            let thisBlunt = Math.round(bodyGroupResult[yBodyGroupId]['ArmorBlunt'].toFixed(3) * 100) / 100;
            let thisHeat = Math.round(bodyGroupResult[yBodyGroupId]['ArmorHeat'].toFixed(3) * 100) / 100;

            let maxAll = Math.max(thisSharp, thisBlunt, thisHeat);

            if (maxAll > maxArmorSharpBluntHeat) {
                maxArmorSharpBluntHeat = maxAll;
            }
        }

        for (let yBodyGroupId in bodyGroupResult) {

            let showValues = {
                ".theHitPoints": Math.round(bodyGroupResult[yBodyGroupId]['HP'].toFixed(3) * 100) / 100,
                ".theArmorSharp": Math.round(bodyGroupResult[yBodyGroupId]['ArmorSharp'].toFixed(3) * 100) / 100,
                ".theArmorBlunt": Math.round(bodyGroupResult[yBodyGroupId]['ArmorBlunt'].toFixed(3) * 100) / 100,
                ".theArmorHeat": Math.round(bodyGroupResult[yBodyGroupId]['ArmorHeat'].toFixed(3) * 100) / 100,
            };

            for (let theClassName in showValues) {
                if (showValues[theClassName] === 0) {
                    $('#bodyGroup' + yBodyGroupId).find(theClassName).html('<span style="color:#c0c0c0">-</span>');
                } else {
                    $('#bodyGroup' + yBodyGroupId).find(theClassName).text(showValues[theClassName]);
                }
            }

            //VISUALS
            let theItemsIds = [];

            let startPercentage = new Decimal(0);
            let gradientParts = [];
            let lastPercentage = Decimal(0);

            let sbh = {
                "s": {
                    "startPercentage": new Decimal(0),
                    "lastPercentage": new Decimal(0),
                    "gradientParts": [],
                },
                "b": {
                    "startPercentage": new Decimal(0),
                    "lastPercentage": new Decimal(0),
                    "gradientParts": [],
                },
                "h": {
                    "startPercentage": new Decimal(0),
                    "lastPercentage": new Decimal(0),
                    "gradientParts": [],
                }
            };

            for (let theFreakingOrder in bodyGroupProtection[yBodyGroupId]) {

                for (let theLayeredItemId in bodyGroupProtection[yBodyGroupId][theFreakingOrder]) {

                    let dataHp = new Decimal(bodyGroupProtection[yBodyGroupId][theFreakingOrder][theLayeredItemId]);

                    let a = dataHp.dividedBy(maxHitPoints).times(100).plus(startPercentage.toFixed(0));
                    lastPercentage = a;
                    let thisPercentage = Math.round(a.toFixed(0));
                    let colorOf = $('#wearme' + theLayeredItemId + ' .theName').css('background-color');
                    gradientParts.push(colorOf + ' ' + startPercentage.toFixed(0) + '% ' + thisPercentage + '%');
                    theItemsIds.push(theLayeredItemId);
                    startPercentage = a;

                    for (let theSBH in bodyGroupSBHProtection[yBodyGroupId][theFreakingOrder][theLayeredItemId]) {
                        let thisInfo = new Decimal(bodyGroupSBHProtection[yBodyGroupId][theFreakingOrder][theLayeredItemId][theSBH]);
                        let perc = thisInfo.dividedBy(maxArmorSharpBluntHeat).times(100).plus(sbh[theSBH]['startPercentage'].toFixed(0));
                        sbh[theSBH]['lastPercentage'] = perc;
                        sbh[theSBH]['gradientParts'].push(colorOf + ' ' + sbh[theSBH]['startPercentage'].toFixed(0) + '% ' + (Math.round(perc.toFixed(0))) + '%');
                        sbh[theSBH]['startPercentage'] = perc;
                    }
                }
            }

            if (lastPercentage.lessThan(100)) {
                gradientParts.push('white ' + Math.round(lastPercentage.toFixed(0)) + '% 100%');
            }

            for (let theSBH in sbh) {
                if (sbh[theSBH]['lastPercentage'].lessThan(100)) {
                    sbh[theSBH]['gradientParts'].push('white ' + Math.round(sbh[theSBH]['lastPercentage'].toFixed(0)) + '% 100%');
                }
            }

            $('#bodyVisualGroup'+yBodyGroupId+' .theProtection')
                .css('background','linear-gradient(to right,' + gradientParts.join(', ')+')')
                .text(showValues['.theHitPoints'] > 0 ? showValues['.theHitPoints'] : '')
                .mouseover(function () {
                    $('#bodyVisualGroup'+yBodyGroupId+' .theName').css('color', 'red');
                    theItemsIds.forEach(function (item) {
                        $('#wearme'+item+' .forBodyGroupHover, #wearme'+item+' .theQuality, #wearme'+item+' .theMaterial').css('background-color',
                            $('#wearme'+item+' .theName').css('background-color')
                        );
                    });
                })
                .mouseout(function () {
                    $('#bodyVisualGroup'+yBodyGroupId+' .theName').css('color', 'black');
                    theItemsIds.forEach(function (item) {
                        $('#wearme'+item+' .forBodyGroupHover, #wearme'+item+' .theQuality, #wearme'+item+' .theMaterial').css('background-color', 'white');
                    });
                });

            $('#bodyVisual2Group'+yBodyGroupId+' .theSharp')
                .css('background','linear-gradient(to right,' + sbh.s.gradientParts.join(', ')+')')
                .text(Math.round(showValues['.theArmorSharp']) > 0 ? Math.round(showValues['.theArmorSharp']) : '')
                .mouseover(function () {
                    $('#bodyVisualGroup'+yBodyGroupId+' .theName').css('color', 'red');
                    theItemsIds.forEach(function (item) {
                        $('#wearme'+item+' .forBodyGroupHover, #wearme'+item+' .theQuality, #wearme'+item+' .theMaterial').css('background-color',
                            $('#wearme'+item+' .theName').css('background-color')
                        );
                    });
                })
                .mouseout(function () {
                    $('#bodyVisualGroup'+yBodyGroupId+' .theName').css('color', 'black');
                    theItemsIds.forEach(function (item) {
                        $('#wearme'+item+' .forBodyGroupHover, #wearme'+item+' .theQuality, #wearme'+item+' .theMaterial').css('background-color', 'white');
                    });
                });


            $('#bodyVisual2Group'+yBodyGroupId+' .theBlunt')
                .css('background','linear-gradient(to right,' + sbh.b.gradientParts.join(', ')+')')
                .text(Math.round(showValues['.theArmorBlunt']) > 0 ? Math.round(showValues['.theArmorBlunt']) : '')
                .mouseover(function () {
                    $('#bodyVisualGroup'+yBodyGroupId+' .theName').css('color', 'red');
                    theItemsIds.forEach(function (item) {
                        $('#wearme'+item+' .forBodyGroupHover, #wearme'+item+' .theQuality, #wearme'+item+' .theMaterial').css('background-color',
                            $('#wearme'+item+' .theName').css('background-color')
                        );
                    });
                })
                .mouseout(function () {
                    $('#bodyVisualGroup'+yBodyGroupId+' .theName').css('color', 'black');
                    theItemsIds.forEach(function (item) {
                        $('#wearme'+item+' .forBodyGroupHover, #wearme'+item+' .theQuality, #wearme'+item+' .theMaterial').css('background-color', 'white');
                    });
                });


            $('#bodyVisual2Group'+yBodyGroupId+' .theHeat')
                .css('background','linear-gradient(to right,' + sbh.h.gradientParts.join(', ')+')')
                .text(Math.round(showValues['.theArmorHeat']) > 0 ? Math.round(showValues['.theArmorHeat']) : '')
                .mouseover(function () {
                    $('#bodyVisualGroup'+yBodyGroupId+' .theName').css('color', 'red');
                    theItemsIds.forEach(function (item) {
                        $('#wearme'+item+' .forBodyGroupHover, #wearme'+item+' .theQuality, #wearme'+item+' .theMaterial').css('background-color',
                            $('#wearme'+item+' .theName').css('background-color')
                        );
                    });
                })
                .mouseout(function () {
                    $('#bodyVisualGroup'+yBodyGroupId+' .theName').css('color', 'black');
                    theItemsIds.forEach(function (item) {
                        $('#wearme'+item+' .forBodyGroupHover, #wearme'+item+' .theQuality, #wearme'+item+' .theMaterial').css('background-color', 'white');
                    });
                });

        }
    }


    $(document).ready(function () {

        bodyGroupOrder.forEach(function (key) {

            let clonedItem = $('#cloneBodyGroup').clone();
            clonedItem.prop('id', 'bodyGroup' + key);
            clonedItem.find('.theName').text(bodyGroups[key]);

            let theSelector = [];
            let theLayers = [1, 2, 3, 4];
            for (let key2 in bodyGroupContains[key]) {
                for (let key3 in theLayers) {
                    theSelector.push('#layer_' + theLayers[key3] + '_' + bodyGroupContains[key][key2]);
                }
            }

            clonedItem.find('.theName').mouseover(function () {
                $(theSelector.join(',')).css('stroke-width', '8');
            });

            clonedItem.find('.theName').mouseout(function () {
                $(theSelector.join(',')).css('stroke-width', '1');
            });


            $('#resultBodyParts').append(clonedItem)

            let clonedItem2 = $('#cloneVisualBodyGroup').clone();
            clonedItem2.prop('id','bodyVisualGroup'+key);
            clonedItem2.find('.theName').text(bodyGroups[key]).css('font-size', '12px').css('font-weight', 'bold');
            clonedItem2.find('.theName').mouseover(function () {
                $(theSelector.join(',')).css('stroke-width', '8');
            });

            clonedItem2.find('.theName').mouseout(function () {
                $(theSelector.join(',')).css('stroke-width', '1');
            });


            let clonedItem3 = $('#cloneVisual2').clone();
            clonedItem3.prop('id','bodyVisual2Group'+key);
            clonedItem3.find('.theName').text(bodyGroups[key]).css('font-size', '12px').css('font-weight', 'bold');
            clonedItem3.find('.theName').mouseover(function () {
                $(theSelector.join(',')).css('stroke-width', '8');
            });

            clonedItem3.find('.theName').mouseout(function () {
                $(theSelector.join(',')).css('stroke-width', '1');
            });


            $('#resultVisualBodyParts').append(clonedItem2);
            $('#resultVisual2BodyParts').append(clonedItem3);

        });



        itemsCore.forEach(function (item) {
            addItem(item, 'coreItemList');
        });

        itemsBiotech.forEach(function (item) {
            if (item.item_id === 27) {
                // https://rimworldwiki.com/wiki/Array%20headset
                // Coverage set as "UpperHead" which means head, skull, brain, ears"
                item.coverage = "1,2,3";//[1, 2, 3];
            }

            addItem(item, 'biotechItemList');
        });


        itemsIdeology.forEach(function (item) {
            addItem(item, 'ideologyItemList');
        });


        itemsRoyality.forEach(function (item) {
            addItem(item, 'royalityItemList');
        });


        showConfy(minimumAcceptableTemperature, maximumAcceptableTemperature);


        $('#armor_sharp_factor, #armor_blunt_factor, #armor_heat_factor, #max_hit_points_factor, #insulation_cold, #insulation_heat').click(function () {

            let thisOne = $(this).prop('id');
            let listOfHeaders = ['armor_sharp_factor', 'armor_blunt_factor', 'armor_heat_factor', 'max_hit_points_factor', 'insulation_cold', 'insulation_heat'];
            for (let i in listOfHeaders) {
                if (listOfHeaders[i] !== thisOne) {
                    $('#' + listOfHeaders[i]).removeClass('orderSelected');
                } else {
                    $('#' + listOfHeaders[i]).removeClass('orderSelected').addClass('orderSelected');
                }
            }
        });

        var hash = $(location).attr('hash').substring(1);
        if (hash !== '') {
            try {
                let theAnchorItems = JSON.parse(atob(hash));
                for (let i in theAnchorItems) {
                    let anchorItemId = parseInt(theAnchorItems[i][0]);
                    let usedColor = null;
                    if(typeof theAnchorItems[i][3] === 'object') {
                        usedColor = [
                            parseInt(theAnchorItems[i][3][0]),
                            parseInt(theAnchorItems[i][3][1]),
                            parseInt(theAnchorItems[i][3][2])
                        ];
                    }

                    wear(
                        JSON.parse(atob($('#theitem' + anchorItemId).data('item-data'))),
                        parseInt(theAnchorItems[i][1]),
                        parseInt(theAnchorItems[i][2]),
                        usedColor
                    );
                }
            } catch (e) {
                console.error('Invalid permalink.'+e.message);
            }
        }

        //number verifications, please ignore
        //verifyCalc(itemsCore);
        //verifyCalc(itemsBiotech);
        //verifyCalc(itemsIdeology);
        //verifyCalc(itemsRoyality);

    }); //ready


    function orderTheseMaterialsBy(theseMaterialIds, byWhat) {
        let toSort = [];
        for (let idx in theseMaterialIds) {
            toSort.push([theseMaterialIds[idx], materialData[theseMaterialIds[idx]][byWhat]]);
        }
        toSort.sort(sortByThis).reverse();

        let sorted = [];
        for (let i in toSort) {
            sorted.push(toSort[i][0]);
        }

        return sorted;
    }

    function sortByThis(a, b) {
        if (a[1] === b[1]) {
            return 0;
        } else {
            return (a[1] < b[1]) ? -1 : 1;
        }
    }

    function showConfy(tmin, tmax) {
        let leftMe = Math.round((new Decimal(270)).plus(tmin).div(540).times(100));
        let rightMe = 100 - Math.round((new Decimal(270)).plus(tmax).div(540).times(100));

        if (tmin > 0) {
            tmin = '+' + tmin;
        }
        if (tmax > 0) {
            tmax = '+' + tmax;
        }

        $('#theRange').css('left', leftMe + '%').css('right', rightMe + '%');
        $('#theRange #minConfy').text(tmin).append('&deg;');
        $('#theRange #maxConfy').text(tmax).append('&deg;');
    }

    // debug function, please ignore
    function verifyCalc(items) {
        items.forEach(function (item) {
            $.ajax({
                url: 'data/variation_' + item.item_id + '.json',
            }).done(function (storedVariation) {

                for (let qualityId in storedVariation) {
                    for (let materialId in storedVariation[qualityId]) {
                        // debug specific item
                        //if (item.item_id == 7 && materialId == 4 && qualityId == 1) {
                        //if (item.item_id == 14 && materialId == 32 && qualityId == 6) {
                        if (true) {
                            let calculated = calculateItemVariation(item.item_id, materialId, qualityId);
                            let ok = true;
                            if (storedVariation[qualityId][materialId].blunt !== calculated.armorBlunt) {
                                ok = false;
                                console.log(item.item_id + ':' + qualityId + ':' + materialId + ': ARMOR BLUNT NOOOOOOOOOOOOOOOOOT OK');
                            }
                            if (storedVariation[qualityId][materialId].heat !== calculated.armorHeat) {
                                ok = false;
                                console.log(item.item_id + ':' + qualityId + ':' + materialId + ':ARMOR HEAT NOOOOOOOOOOOOOOOOOT OK');
                            }
                            if (storedVariation[qualityId][materialId].sharp !== calculated.armorSharp) {
                                ok = false;
                                console.log(item.item_id + ':' + qualityId + ':' + materialId + ':ARMOR SHARP NOOOOOOOOOOOOOOOOOT OK');
                            }
                            if (storedVariation[qualityId][materialId].insulation_cold !== -calculated.cold) {
                                ok = false;
                                console.log(item.item_id + ':' + qualityId + ':' + materialId + ':COLD NOOOOOOOOOOOOOOOOOT OK');
                            }
                            if (storedVariation[qualityId][materialId].insulation_heat !== calculated.heat) {
                                ok = false;
                                console.log(item.item_id + ':' + qualityId + ':' + materialId + ':HEAT NOOOOOOOOOOOOOOOOOT OK');
                            }
                            if (storedVariation[qualityId][materialId].hitpoints !== calculated.hitPoints) {
                                ok = false;
                                console.log(item.item_id + ':' + qualityId + ':' + materialId + ':HITPOINTS NOOOOOOOOOOOOOOOOOT OK');
                            }

                            if (!ok) {
                                console.error('(' + item.item_name + '|' + materials[materialId] + '|' + quality[qualityId] + ')' + 'COMPARE STORED ' + item.item_id + ':' + materialId + ':' + qualityId);
                                console.log(storedVariation[qualityId][materialId]);
                                console.log('(' + item.item_name + ')' + 'COMPARE CALCULATED');
                                console.log(calculated);

                            } else {
                                let msg = '';
                                msg += '[' + storedVariation[qualityId][materialId].blunt + '=' + calculated.armorBlunt + ']';
                                msg += '[' + storedVariation[qualityId][materialId].heat + '=' + calculated.armorHeat + ']';
                                msg += '[' + storedVariation[qualityId][materialId].sharp + '=' + calculated.armorSharp + ']';
                                msg += '[' + storedVariation[qualityId][materialId].insulation_cold + '=' + (-calculated.cold) + ']';
                                msg += '[' + storedVariation[qualityId][materialId].insulation_heat + '=' + calculated.heat + ']';
                                msg += '[' + storedVariation[qualityId][materialId].hitpoints + '=' + calculated.hitPoints + ']';
                                console.log('OK (' + item.item_name + '|' + materials[materialId] + '|' + quality[qualityId] + ')' + msg)

                            }
                            console.log('===============================================');
                        }
                    }
                }

            }).fail(function () {
                alert('Cannot load data json for item variations.');
            });
        });
    }


</script>
<div class="container-fluid text-center w-100 mt-1 pt-2" style="border-top: 1px solid #c0c0c0;">

    <div class="row">
        <div class="col">
            <a class="btn btn-light" href="https://store.steampowered.com/app/294100/RimWorld/" target="_blank" title="https://store.steampowered.com/app/294100/RimWorld/">
                <img src="images/steam.svg" width="36" height="36" border="0">
                Rimworld on STEAM
            </a>
        </div>
        <div class="col">
            <a class="btn btn-success" href="https://youtu.be/7cYx4Wq9Zh4" target="_blank">
                <img src="images/youtube.svg" width="36" height="36" border="0">
                Find out how this works
            </a>
        </div>
        <div class="col">
            <a class="btn btn-light" href="https://rimworldwiki.com/" target="_blank">
                <img src="images/72px-RimWorldLogo.png" width="36" height="36" border="0">
                Rimworld Wiki
            </a>
        </div>
    </div>
</div>
